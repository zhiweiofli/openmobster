<project>
	<parent>
	   <groupId>org.openmobster.core.mobileCloud.rimos</groupId>
	   <artifactId>mobileCloud-rimos</artifactId>
	   <version>2.0-M1</version>
	   <relativePath>../pom.xml</relativePath>
	</parent>
	
	<modelVersion>4.0.0</modelVersion>	
	<name>mobileCloud-runtime</name>	
	<artifactId>mobileCloud-runtime</artifactId>	
	<packaging>jar</packaging>
	
	<dependencies>
		<dependency>
			<groupId>org.openmobster.core.mobileCloud.rimos</groupId>
			<artifactId>common</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>org.openmobster.core.mobileCloud.rimos</groupId>
			<artifactId>moblet-runtime</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>org.openmobster.core.mobileCloud.rimos</groupId>
			<artifactId>sync</artifactId>
			<version>${project.version}</version>
		</dependency>
	</dependencies>
		
	<!-- build configuration -->
	<build>	        
		<plugins>		        
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-antrun-plugin</artifactId>
				<executions>
				<execution>
					<phase>install</phase>
					<configuration>
						<tasks>
						        <property name="preverify_target" 
						        value="${basedir}/target/rapc"
						        />
						        <property name="preverify_src" 
						        value="${basedir}/target/mobileCloud.jar"
						        />
						        <property name="rapc_src" 
						        value="${preverify_target}/mobileCloud.jar"
						        />
						        <property name="rapc_config" 
						        value="${basedir}/src/main/config/rapc/mobileCloud.rapc"
						        />						        						        
						        
						        <delete dir="${preverify_target}"/>
						        <delete file="${preverify_src}"/>
						        <mkdir dir="${preverify_target}"/>
						        
						        <unzip src="${settings.localRepository}/org/openmobster/core/mobileCloud/rimos/api/${project.version}/api-${project.version}.jar" 
							    dest="${basedir}/target/thirdparty" overwrite="true"/>							    							   
							    <unzip src="${settings.localRepository}/org/openmobster/core/mobileCloud/rimos/common/${project.version}/common-${project.version}.jar" 
							    dest="${basedir}/target/thirdparty" overwrite="true"/>
							    <unzip src="${settings.localRepository}/org/openmobster/core/mobileCloud/rimos/sync/${project.version}/sync-${project.version}.jar" 
							    dest="${basedir}/target/thirdparty" overwrite="true"/>							    
							    <unzip src="${settings.localRepository}/org/openmobster/core/mobileCloud/rimos/mobileObject/${project.version}/mobileObject-${project.version}.jar" 
							    dest="${basedir}/target/thirdparty" overwrite="true"/>
							    <unzip src="${settings.localRepository}/org/openmobster/core/mobileCloud/rimos/bus/${project.version}/bus-${project.version}.jar" 
							    dest="${basedir}/target/thirdparty" overwrite="true"/>
							    <unzip src="${settings.localRepository}/org/openmobster/core/mobileCloud/rimos/connection/${project.version}/connection-${project.version}.jar" 
							    dest="${basedir}/target/thirdparty" overwrite="true"/>
							    <unzip src="${settings.localRepository}/org/openmobster/core/mobileCloud/rimos/appstore/${project.version}/appstore-${project.version}.jar" 
							    dest="${basedir}/target/thirdparty" overwrite="true"/>
						        						        						                        						       
						        <jar file="${preverify_src}">
						        	<fileset dir="${basedir}/target/classes">						        		
						        	</fileset>	
						        	<fileset dir="${basedir}/target/thirdparty">
							        	<exclude name="**/META-INF/**"/>
							        </fileset>					        						        								        						    
						        </jar>						        
						        						    						        						        
								<echo>Generating the BlackBerry OpenMobster Mobile Cloud....</echo>
								
								<echo>Preverifying....</echo>
								<exec dir="${preverify_target}" executable="preverify">
									<arg line="-classpath ${basedir}/../../../net_rim_api.jar -d ${preverify_target} ${preverify_src}"/>
								</exec>
								
								
								<echo>Generating the Executable....</echo>
								<exec dir="${preverify_target}" executable="rapc">
					  				<arg line="import=${basedir}/../../../net_rim_api.jar codename=mobileCloud ${rapc_config} ${rapc_src}"/>
								</exec>	
								
								<copy todir="${settings.localRepository}/org/openmobster/core/mobileCloud/rimos/apps" 
							    file="${preverify_target}/mobileCloud.cod" overwrite="true"/>	
							    <copy todir="${settings.localRepository}/org/openmobster/core/mobileCloud/rimos/apps" 
							    overwrite="true">
							    	<fileset dir="${preverify_target}">
							    		<include name="**/*.debug"/>
							    	</fileset>
							    </copy>													
						</tasks>
					</configuration>
					<goals>
						<goal>run</goal>
					</goals>
				</execution>
				<execution>
					    <id>install-mobileCloud-runtime</id>
						<phase>install</phase>
						<configuration>
							<tasks>	
								<copy tofile="${settings.localRepository}/org/openmobster/core/mobileCloud/rimos/mobileCloud-runtime/${project.version}/mobileCloud-runtime.jar" 
								file="${basedir}/target/mobileCloud.jar" overwrite="true"/>					                                        						        							        						        						        						    						        						        																			
							</tasks>
						</configuration>
						<goals>
							<goal>run</goal>
						</goals>
					</execution>
				</executions>
			</plugin>
		</plugins>
	</build>
</project>